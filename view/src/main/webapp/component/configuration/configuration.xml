<?xml version="1.0" encoding="UTF-8"?>
<engine>
	<dot>
		<div class="configuration-content padding">
			<h3 class="bold">{{=i18n('configurations')}}</h3>
			<form id="profile-configuration" method="post" enctype="multipart/form-data">
				<div class="field margin-bottom">
					<input id="profile-pic-uploader" type="file" name="profile" data-url="{{=it.uploadUrls[0]}}" data-message="{{=i18n('profile-pic')}}"/>
				</div>
				<div class="field margin-bottom">
					<input id="background-pic-uploader" type="file" name="background" data-url="{{=it.uploadUrls[1]}}" data-message="{{=i18n('background-pic')}}"/>
				</div>
			</form>
		</div>
	</dot>
	<script>
		$('#profile-pic-uploader').fileupload({
			dataType: 'json',
			done: function (e, data) {
				userHelper.update(function(user) {
					$('.profile-pic').attr('src', user.profileImageUrl);
				});
				$.getJSON('s/image/uploadUrl?' + $.param({callbackUrl : '/s/user/profilePic' }), function(uploadUrl) {
					$('#profile-pic-uploader').data('url', uploadUrl);
				});
			}
		});

		$('#background-pic-uploader').fileupload({
			dataType: 'json',
			done : function(e, data) {
				userHelper.update();
				$.getJSON('s/image/uploadUrl?' + $.param({callbackUrl : '/s/user/backgroundPic' }), function(uploadUrl) {
					$('#background-pic-uploader').data('url', uploadUrl);
				});
			}
		});
	</script>
</engine>