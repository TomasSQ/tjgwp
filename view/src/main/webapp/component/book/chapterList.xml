<engine>
	<dot>
		<div class="chapters-list padding clearfix">
		<!-- 
		{{? it.book.chapters && it.book.chapters.length}}
		 -->
		{{~it.book.chapters :chapter}}
			<div class="chapter float-left margin-right" data-chapter-id="{{=chapter.id}}">
				<div class="chapter-cape">
				{{? chapter.capeImageUrl}}
					<img class="chapter-cape-url" src="" title="{{=chapter.title}}"></img>
				{{??}}
					<div class="title" data-no-animation="true">{{=chapter.title}}</div>
				{{?}}
					<div class="buttons clearfix">
						<input type="file" name="chapterCape" data-url="{{=chapter.uploadUrl}}" data-message="{{=i18n('cape')}}"/>
						<span class="btn edit">{{=i18n('edit')}}</span>
						<span class="btn {{=chapter.publishDate ? 'unpublish' : 'publish'}}">{{=i18n(chapter.publishDate ? 'unpublish' : 'publish')}}</span>
					</div>
				</div>
				{{? chapter.capeImageUrl}}
				<div class="chapter-title">{{=chapter.title}}</div>
				{{?}}
				<div class="chapter-details padding">
				</div>
			</div>
		{{~}}
		{{?}}
			<div class="chapter new float-left margin-right">
				<div class="chapter-cape">
					<div class="title" data-no-animation="true">
						{{=i18n('new-chapter')}}
					</div>
				</div>
			</div>
		</div>
	</dot>
	<script>
		if (context.book.chapters && context.book.chapters.length > 0)
			for (var i = 0; context.book.chapters.length > i; i++)
				container.find('[data-chapter-id="' + context.book.chapters[i].id + '"] img').attr('src', context.book.chapters[i].capeImageUrl);

		console.info(container);
		container
			.addClass('active')
			.find('.chapter .chapter-cape .title').fitText().end()
			.find('.chapter.new').click(function() {
				location.hash = 'write/' + context.bookId + '/new-chapter';
			});
	</script>
</engine>